<!doctype html><html lang=en><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Docker学习笔记 | 技术博客</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel=stylesheet><style>:root{--nav-height:60px;--toc-width:280px;--content-padding:40px;--primary-color:#3498db;--text-color:#333;--light-gray:#f5f5f5;--border-color:#eaeaea}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;color:var(--text-color);line-height:1.6;padding-top:var(--nav-height);overflow-x:hidden}.top-nav{position:fixed;top:0;left:0;right:0;height:var(--nav-height);background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;align-items:center;padding:0 30px;z-index:1000}.nav-container{width:100%;max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.site-title{font-size:1.4rem;font-weight:700;color:var(--primary-color);text-decoration:none}.nav-links{display:flex;gap:25px}.nav-links a{color:var(--text-color);text-decoration:none;font-size:1rem;transition:color .3s}.nav-links a:hover{color:var(--primary-color)}.main-container{display:flex;max-width:1400px;margin:0 auto;padding:20px}.toc-container{position:sticky;top:calc(var(--nav-height) + 20px);align-self:flex-start;width:var(--toc-width);padding:20px;margin-right:30px;max-height:calc(100vh - var(--nav-height) - 40px);overflow-y:auto;background:var(--light-gray);border-radius:8px;scroll-behavior:auto;overscroll-behavior:contain}.toc-title{font-size:1.2rem;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid var(--primary-color)}.toc ul{list-style:none;padding-left:15px}.toc li{margin-bottom:8px;position:relative}.toc a{color:var(--text-color);text-decoration:none;display:block;padding:5px 0 5px 10px;transition:all .2s;font-size:.95rem;border-left:2px solid transparent}.toc a:hover{color:var(--primary-color);transform:translateX(5px)}.toc a.active{color:var(--primary-color);font-weight:700;border-left:3px solid var(--primary-color);background:rgba(52,152,219,5%);transform:translateX(5px)}.content-container{flex:1;background:#fff;padding:var(--content-padding);border-radius:8px;box-shadow:0 2px 15px rgba(0,0,0,5%)}.article-header{margin-bottom:30px;border-bottom:1px solid var(--border-color);padding-bottom:20px}.article-title{font-size:2rem;margin-bottom:10px;color:#2c3e50}.article-meta{display:flex;gap:20px;color:#7f8c8d;font-size:.9rem;margin-bottom:15px}.article-content{line-height:1.8}.article-content h2{font-size:1.6rem;margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:1px solid var(--border-color);scroll-margin-top:calc(var(--nav-height) + 20px)}.article-content h3{font-size:1.3rem;margin:1.5rem 0 .8rem;scroll-margin-top:calc(var(--nav-height) + 20px)}.article-content img{max-width:100%;height:auto;border-radius:6px;margin:1.5rem 0;box-shadow:0 3px 10px rgba(0,0,0,.1)}.article-content pre{position:relative;background:#f7f7f7;color:#242424;border-left:4px solid #04b04f;border-radius:8px;padding:1.5rem 1rem 1rem;margin:1.5rem 0;overflow:auto;box-shadow:0 1px 3px rgba(0,0,0,.1);max-height:40vh;white-space:pre-wrap;font-family:fira code,Menlo,Monaco,Consolas,monospace;font-size:.9rem;line-height:1.5;scrollbar-width:thin;scrollbar-color:#c4c4c4 #f7f7f7}.article-content code{font-family:inherit;color:inherit!important;background:0 0!important;padding:0;text-shadow:none!important;font-size:.9rem}.hljs-meta,.hljs-built_in{color:#04b04f}.hljs-attribute{color:#e91e63}.hljs-string{color:#2e7d32}.hljs-number{color:#2196f3}.article-content pre::-webkit-scrollbar{width:12px;height:12px}.article-content pre::-webkit-scrollbar{width:12px;height:12px}.article-content pre::-webkit-scrollbar-thumb{background:#04b04f;opacity:.6;border:3px solid #f7f7f7}.article-content pre::-webkit-scrollbar-track{background:#f7f7f7;border-radius:6px}.copy-code{position:absolute;top:10px;right:15px;background:rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.2);color:#242424;border-radius:4px;padding:3px 8px;font-size:.8rem;cursor:pointer;transition:all .3s;opacity:0;z-index:10}pre:hover .copy-code{opacity:1}.copy-code:hover{background:rgba(0,0,0,.2)}.copy-code.copied{background:#28a745;color:#fff;border-color:#28a745}@media(max-width:1024px){.toc-container{width:240px;padding:15px}.content-container{padding:25px}}@media(max-width:768px){.main-container{flex-direction:column}.toc-container{position:static;width:100%;margin-right:0;margin-bottom:30px;max-height:none}.article-title{font-size:1.8rem}.article-content pre{max-height:50vh;padding-right:10px}}</style></head><body><nav class=top-nav><div class=nav-container><a href=/ class=site-title>技术博客</a><div class=nav-links><a href=/>首页</a>
<a href=/posts/>所有文章</a>
<a href=/categories/>分类</a>
<a href=/tags/>标签</a></div></div></nav><div class=main-container><aside class=toc-container><h3 class=toc-title>目录</h3><div class=toc><nav id=TableOfContents><ul><li><a href=#什么是docker>什么是docker</a></li><li><a href=#准备工作>准备工作</a></li><li><a href=#如何安装docker>如何安装docker</a></li><li><a href=#使用docker构建基于mysqlnginxwordpress的个人站点>使用docker构建基于<code>mysql</code>，<code>nginx</code>、<code>wordpress</code>的个人站点</a></li><li><a href=#理解-docker>理解 Docker</a><ul><li><a href=#1-概念>1. 概念</a><ul><li><a href=#11-docker-image镜像>1.1 Docker Image（镜像）</a></li><li><a href=#12-docker-container容器>1.2 Docker Container（容器）</a></li><li><a href=#13-image-与-container-的关系>1.3 Image 与 Container 的关系</a></li></ul></li><li><a href=#2-dockerfile>2. Dockerfile</a><ul><li><a href=#21-作用>2.1 作用</a></li><li><a href=#22-常用指令>2.2 常用指令</a></li><li><a href=#23-示例>2.3 示例</a></li></ul></li><li><a href=#3-docker-compose>3. Docker Compose</a><ul><li><a href=#31-作用>3.1 作用</a></li><li><a href=#32-概念>3.2 概念</a></li><li><a href=#33-示例>3.3 示例</a></li></ul></li><li><a href=#4-常用命令>4. 常用命令</a><ul><li><a href=#41-镜像相关>4.1 镜像相关</a></li><li><a href=#42-容器相关>4.2 容器相关</a></li><li><a href=#43-compose-相关>4.3 Compose 相关</a></li></ul></li><li><a href=#5-实践建议>5. 实践建议</a></li><li><a href=#6-常见问题排查>6. 常见问题排查</a><ul><li><a href=#3-dockerfile>3. <strong>Dockerfile</strong></a></li></ul></li><li><a href=#从开发到部署>从开发到部署</a></li><li><a href=#多服务项目>多服务项目</a></li></ul></li><li><a href=#理解要点>理解要点</a><ul><li><a href=#image-与-container-关系>Image 与 Container 关系</a></li></ul></li><li><a href=#用简单的实例来理解docker容器化整个项目过程>用简单的实例来理解Docker容器化整个项目过程</a><ul><li><a href=#项目结构>项目结构</a></li><li><a href=#步骤>步骤</a><ul><li><a href=#1-创建dockerfile>1. 创建Dockerfile</a></li><li><a href=#2-创建docker-composeyml>2. 创建docker-compose.yml</a></li><li><a href=#3-创建requirementstxt>3. 创建requirements.txt</a></li><li><a href=#4-配置django项目>4. 配置Django项目</a></li><li><a href=#5-构建并运行>5. 构建并运行</a></li><li><a href=#6-执行数据库迁移>6. 执行数据库迁移</a></li><li><a href=#7-访问应用>7. 访问应用</a></li></ul></li><li><a href=#深入细节>深入细节</a><ul><li><a href=#数据持久化>数据持久化</a></li><li><a href=#开发模式>开发模式</a></li><li><a href=#生产环境>生产环境</a></li></ul></li></ul></li><li><a href=#国内可用-docker镜像源registry-mirrors>国内可用 Docker镜像源（registry-mirrors）</a></li></ul></nav></div></aside><article class=content-container><header class=article-header><h1 class=article-title>Docker学习笔记</h1><div class=article-meta><span>📅 2025年10月4日</span>
<span>📁 <a href=/categories/%E9%BB%98%E8%AE%A4%E5%88%86%E7%B1%BB>默认分类</a></span></div></header><div class=article-content><h1 id=docker-学习笔记>Docker 学习笔记</h1><h2 id=什么是docker>什么是docker</h2><p>docker is a virtual platform for developer to pack the application and the environment together as container ,and finally delivery the docker container to customer to use .</p><h2 id=准备工作>准备工作</h2><p>prerequisite（docker is originally from <code>linux</code> ,so you must install windows subsystem for <code>linux</code>）</p><ul><li>enable the two options of <code>wsl</code> and virtual machine platform within program function in control panel of windows.</li><li>reboot windows</li></ul><h2 id=如何安装docker>如何安装docker</h2><ul><li>install <code>ubuntu</code> of the newest ·<code>lts</code> version from <code>microsoft</code> store .please refer to the <code>microsoft</code> document on how to install <code>wsl</code>. after download the installation execution file ,double the file to run setup ，remember to select the option of Use <code>WSL 2</code> instead of Hyper-V (recommended) and don&rsquo;t select the option of" Allow Windows Containers to be used with this installation",because we need to run docker under <code>wsl</code>.</li><li>start <code>wsl</code><ul><li>you should use windows <code>powershell</code> to run <code>wsl</code> command ,and then run into the shell of <code>wsl</code> . remember not to run <code>ubuntu</code> directly which is installed from <code>microsoft</code> store. you should use <code>wsl2</code> rather than <code>wsl1</code>.if you open the <code>ubuntu</code> from windows start menu,the default version is <code>wsl1</code>,so you&rsquo;d better run <code>wsl</code> within windows <code>powershell</code>.</li></ul></li></ul><p>the core concepts of docker</p><ul><li><p>image</p><p>like a configuration template of the application and its environment .</p></li><li><p>container</p><p>be a instance of the configuration template of the application and environment .</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>1. 镜像 (Image) = 产品设计图
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    包含应用程序和运行环境
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    标准化、不可变的模板
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>2. 容器 (Container) = 产品实例
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    根据设计图创建的运行实例
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    每个实例都是独立的
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>3. Docker Compose = 装配说明书
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    定义多个产品如何组装成完整系统
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    管理实例间的协作关系
</span></span></code></pre></div></li></ul><h2 id=使用docker构建基于mysqlnginxwordpress的个人站点>使用docker构建基于<code>mysql</code>，<code>nginx</code>、<code>wordpress</code>的个人站点</h2><h2 id=理解-docker>理解 Docker</h2><h3 id=1-概念>1. 概念</h3><h4 id=11-docker-image镜像>1.1 Docker Image（镜像）</h4><ul><li><strong>定义</strong>：是一个只读的模板，或者把它看做一个package,包含了运行应用所需的代码、运行时、库、环境变量和配置文件。</li><li><strong>特点</strong>：<ul><li>分层存储，每一层代表镜像构建过程中的一步，这些层是只读的。</li><li>可以共享和版本化管理（通过标签）。</li></ul></li><li><strong>类比</strong>：如同软件安装包（例如Office安装程序），已经包含了所有必要的文件，但尚未运行。</li></ul><h4 id=12-docker-container容器>1.2 Docker Container（容器）</h4><ul><li><strong>定义</strong>：是镜像的一个运行实例。容器进程运行于隔离的环境中，拥有自己的文件系统、网络和进程空间。</li><li><strong>特点</strong>：<ul><li>基于镜像创建，在镜像之上添加一个可写层（容器层）。</li><li>容器内的修改是临时的，当容器删除后，这些修改也会丢失（除非使用数据卷）。</li></ul></li><li><strong>类比</strong>：如同运行中的软件（例如打开的Word程序），有运行状态和数据。</li></ul><h4 id=13-image-与-container-的关系>1.3 Image 与 Container 的关系</h4><ul><li>一个镜像可以创建多个容器，这些容器相互独立。</li><li>容器是镜像的一次运行，镜像静态存储，容器动态运行。</li></ul><h3 id=2-dockerfile>2. Dockerfile</h3><h4 id=21-作用>2.1 作用</h4><ul><li><p>用于定义镜像构建过程，包含一系列指令，每一条指令构建一层。</p></li><li><p>通过Dockerfile可以自定义镜像，包括基础镜像选择、文件复制、依赖安装、环境变量设置、启动命令等。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 作用：构建镜像的蓝图/说明书
</span></span><span class=line><span class=cl> 包含：环境配置、依赖安装、代码复制、启动命令
</span></span><span class=line><span class=cl> 结果：通过 docker build 生成 Docker Image
</span></span></code></pre></div></li></ul><h4 id=22-常用指令>2.2 常用指令</h4><ul><li><code>FROM</code>：指定基础镜像。</li><li><code>RUN</code>：执行命令，例如安装软件。</li><li><code>COPY</code> 或 <code>ADD</code>：复制文件到镜像中。</li><li><code>WORKDIR</code>：设置工作目录。</li><li><code>ENV</code>：设置环境变量。</li><li><code>EXPOSE</code>：声明容器运行时监听的端口。</li><li><code>CMD</code> 或 <code>ENTRYPOINT</code>：指定容器启动时运行的命令。</li></ul><h4 id=23-示例>2.3 示例</h4><p>dockerfile</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>FROM python:3.9
</span></span><span class=line><span class=cl>WORKDIR /app
</span></span><span class=line><span class=cl>COPY requirements.txt .
</span></span><span class=line><span class=cl>RUN pip install -r requirements.txt
</span></span><span class=line><span class=cl>COPY . .
</span></span><span class=line><span class=cl>CMD [&#34;python&#34;, &#34;app.py&#34;]
</span></span></code></pre></div><h3 id=3-docker-compose>3. Docker Compose</h3><h4 id=31-作用>3.1 作用</h4><ul><li><p>用于定义和运行多容器Docker应用程序。通过一个YAML文件配置应用的服务、网络、数据卷等。</p></li><li><p>可以一键启动、停止、重建整个应用。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl> 作用：多容器应用编排工具
</span></span><span class=line><span class=cl> 功能：协调多个相关容器协同工作
</span></span><span class=line><span class=cl> 场景：Web应用 + 数据库 + 缓存等完整项目栈
</span></span></code></pre></div></li></ul><h4 id=32-概念>3.2 概念</h4><ul><li><strong>服务（Service）</strong>：一个服务代表一个容器，对应一个镜像。</li><li><strong>项目（Project）</strong>：由一组关联的服务组成，通常对应一个完整的应用（例如前端、后端、数据库）。</li></ul><h4 id=33-示例>3.3 示例</h4><p>yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>version: &#39;3&#39;
</span></span><span class=line><span class=cl>services:
</span></span><span class=line><span class=cl>  web:
</span></span><span class=line><span class=cl>    build: .
</span></span><span class=line><span class=cl>    ports:
</span></span><span class=line><span class=cl>      - &#34;8000:8000&#34;
</span></span><span class=line><span class=cl>  db:
</span></span><span class=line><span class=cl>    image: postgres:13
</span></span><span class=line><span class=cl>    environment:
</span></span><span class=line><span class=cl>      POSTGRES_DB: myapp
</span></span></code></pre></div><h3 id=4-常用命令>4. 常用命令</h3><h4 id=41-镜像相关>4.1 镜像相关</h4><ul><li><code>docker build -t [image_name] .</code>：构建镜像。</li><li><code>docker images</code>：列出本地镜像。</li><li><code>docker rmi [image_id]</code>：删除镜像。</li></ul><h4 id=42-容器相关>4.2 容器相关</h4><ul><li><code>docker run [options] [image]</code>：创建并启动容器。<ul><li>常用选项：<code>-d</code>（后台运行）、<code>-p</code>（端口映射）、<code>-v</code>（数据卷）、<code>-e</code>（环境变量）、<code>--name</code>（容器命名）。</li></ul></li><li><code>docker ps</code>：查看运行中的容器。</li><li><code>docker stop [container_id]</code>：停止容器。</li><li><code>docker start [container_id]</code>：启动已停止的容器。</li><li><code>docker rm [container_id]</code>：删除容器。</li></ul><h4 id=43-compose-相关>4.3 Compose 相关</h4><ul><li><code>docker-compose up -d</code>：启动所有服务（后台运行）。</li><li><code>docker-compose down</code>：停止并删除所有服务。</li><li><code>docker-compose logs [service]</code>：查看服务日志。</li></ul><h3 id=5-实践建议>5. 实践建议</h3><ol><li><strong>从简单项目开始</strong>：例如将一个静态网站或简单的Web应用容器化。</li><li><strong>逐步增加复杂度</strong>：尝试多服务应用，比如带数据库的Web应用。</li><li><strong>学习优化</strong>：例如使用多阶段构建减小镜像大小，合理使用数据卷持久化数据。</li></ol><h3 id=6-常见问题排查>6. 常见问题排查</h3><ul><li>容器启动失败：查看日志 <code>docker logs [container_id]</code>。</li><li>进入容器调试：<code>docker exec -it [container_id] bash</code>。</li><li>检查网络：<code>docker network ls</code>，确保容器间网络连通。</li></ul><p>希望这份笔记能帮助您巩固Docker的知识！实践出真知，动手操作是最好的学习方式。</p><h4 id=3-dockerfile>3. <strong>Dockerfile</strong></h4><ul><li><strong>作用</strong>：构建镜像的蓝图/说明书</li><li><strong>包含</strong>：环境配置、依赖安装、代码复制、启动命令</li><li><strong>结果</strong>：通过 <code>docker build</code> 生成 Docker Image</li></ul><h3 id=从开发到部署>从开发到部署</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Dockerfile → docker build → Image → docker run → Container
</span></span></code></pre></div><h3 id=多服务项目>多服务项目</h3><p>text</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>多个Dockerfile → 多个Image → docker-compose up → 多个协同工作的Container
</span></span></code></pre></div><h2 id=理解要点>理解要点</h2><h3 id=image-与-container-关系>Image 与 Container 关系</h3><ul><li><p><strong>一个 Image</strong> 可以创建 <strong>多个 Container</strong></p></li><li><p>Image 是模板，Container 是实例</p></li><li><p>Container = Image + 可写层 + 运行时状态</p><p>Docker 的设计哲学就是：</p><ul><li><strong>镜像包含一切</strong>：应用代码、运行时、依赖、配置</li><li><strong>容器即进程</strong>：启动容器就像启动一个进程</li><li><strong>声明式配置</strong>：所有运行时配置通过命令行参数指定</li></ul><p><strong>从 Image 到 Container，只需要 <code>docker run</code> 这一个命令</strong></p></li></ul><h2 id=用简单的实例来理解docker容器化整个项目过程>用简单的实例来理解Docker容器化整个项目过程</h2><p>假设我们要构建一个简单的Django项目，并使用Docker进行容器化，同时使用Docker Compose来管理多个服务（比如Django和PostgreSQL）。</p><h3 id=项目结构>项目结构</h3><p>假设项目结构如下：</p><p>text</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>my_django_app/
</span></span><span class=line><span class=cl>├── Dockerfile
</span></span><span class=line><span class=cl>├── docker-compose.yml
</span></span><span class=line><span class=cl>├── requirements.txt
</span></span><span class=line><span class=cl>└── project/
</span></span><span class=line><span class=cl>    ├── manage.py
</span></span><span class=line><span class=cl>    └── ... (其他Django项目文件)
</span></span></code></pre></div><h3 id=步骤>步骤</h3><h4 id=1-创建dockerfile>1. 创建Dockerfile</h4><p>Dockerfile用于构建Django应用的镜像。</p><p>Dockerfile</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl># 使用官方Python运行时作为基础镜像
</span></span><span class=line><span class=cl>FROM python:3.9
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 设置工作目录
</span></span><span class=line><span class=cl>WORKDIR /app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 复制当前目录（项目）内容到容器的/app目录
</span></span><span class=line><span class=cl>COPY . /app
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 安装所需的包
</span></span><span class=line><span class=cl>RUN pip install -r requirements.txt
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 暴露端口8000，以便外部访问
</span></span><span class=line><span class=cl>EXPOSE 8000
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl># 运行Django开发服务器
</span></span><span class=line><span class=cl>CMD [&#34;python&#34;, &#34;manage.py&#34;, &#34;runserver&#34;, &#34;0.0.0.0:8000&#34;]
</span></span></code></pre></div><h4 id=2-创建docker-composeyml>2. 创建docker-compose.yml</h4><p>docker-compose.yml用于定义和运行两个服务：web（Django）和db（PostgreSQL）。</p><p>yaml</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=n>version</span><span class=p>:</span> <span class=s1>&#39;3&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>services</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>db</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>image</span><span class=p>:</span> <span class=n>postgres</span><span class=p>:</span><span class=mi>13</span>
</span></span><span class=line><span class=cl>    <span class=n>environment</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>POSTGRES_DB</span><span class=p>:</span> <span class=n>myapp</span>
</span></span><span class=line><span class=cl>      <span class=n>POSTGRES_USER</span><span class=p>:</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>      <span class=n>POSTGRES_PASSWORD</span><span class=p>:</span> <span class=n>password</span>
</span></span><span class=line><span class=cl>    <span class=n>volumes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>postgres_data</span><span class=p>:</span><span class=o>/</span><span class=k>var</span><span class=o>/</span><span class=n>lib</span><span class=o>/</span><span class=n>postgresql</span><span class=o>/</span><span class=n>data</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>web</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>build</span><span class=p>:</span> <span class=o>.</span>
</span></span><span class=line><span class=cl>    <span class=n>command</span><span class=p>:</span> <span class=n>python</span> <span class=n>manage</span><span class=o>.</span><span class=n>py</span> <span class=n>runserver</span> <span class=mf>0.0</span><span class=o>.</span><span class=mf>0.0</span><span class=p>:</span><span class=mi>8000</span>
</span></span><span class=line><span class=cl>    <span class=n>volumes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=o>.</span><span class=p>:</span><span class=o>/</span><span class=n>app</span>
</span></span><span class=line><span class=cl>    <span class=n>ports</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=s2>&#34;8000:8000&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>depends_on</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>db</span>
</span></span><span class=line><span class=cl>    <span class=n>environment</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>DATABASE_URL</span><span class=p>:</span> <span class=n>postgres</span><span class=p>:</span><span class=o>//</span><span class=n>user</span><span class=p>:</span><span class=n>password</span><span class=err>@</span><span class=n>db</span><span class=p>:</span><span class=mi>5432</span><span class=o>/</span><span class=n>myapp</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>volumes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>postgres_data</span><span class=p>:</span>
</span></span></code></pre></div><h4 id=3-创建requirementstxt>3. 创建requirements.txt</h4><p>确保在项目根目录有requirements.txt文件，包含Django和psycopg2（PostgreSQL适配器）等依赖。</p><p>text</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>Django&gt;=3.2
</span></span><span class=line><span class=cl>psycopg2-binary&gt;=2.9
</span></span></code></pre></div><h4 id=4-配置django项目>4. 配置Django项目</h4><p>在Django项目的settings.py中，需要配置数据库连接，使用环境变量。</p><p>python</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>import os
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>DATABASES = {
</span></span><span class=line><span class=cl>    &#39;default&#39;: {
</span></span><span class=line><span class=cl>        &#39;ENGINE&#39;: &#39;django.db.backends.postgresql&#39;,
</span></span><span class=line><span class=cl>        &#39;NAME&#39;: os.environ.get(&#39;POSTGRES_DB&#39;, &#39;myapp&#39;),
</span></span><span class=line><span class=cl>        &#39;USER&#39;: os.environ.get(&#39;POSTGRES_USER&#39;, &#39;user&#39;),
</span></span><span class=line><span class=cl>        &#39;PASSWORD&#39;: os.environ.get(&#39;POSTGRES_PASSWORD&#39;, &#39;password&#39;),
</span></span><span class=line><span class=cl>        &#39;HOST&#39;: &#39;db&#39;,  # 使用Compose中定义的服务名
</span></span><span class=line><span class=cl>        &#39;PORT&#39;: 5432,
</span></span><span class=line><span class=cl>    }
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div><h4 id=5-构建并运行>5. 构建并运行</h4><p>在项目根目录（有docker-compose.yml的目录）运行：</p><p>bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose up
</span></span></code></pre></div><p>这将构建web服务的镜像（如果还没有的话），并启动db和web两个容器。web容器将运行Django开发服务器，并监听8000端口。</p><h4 id=6-执行数据库迁移>6. 执行数据库迁移</h4><p>在另一个终端，运行：</p><p>bash</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>docker-compose exec web python manage.py migrate
</span></span></code></pre></div><h4 id=7-访问应用>7. 访问应用</h4><p>打开浏览器访问 http://localhost:8000，应该能看到Django欢迎页面。</p><h3 id=深入细节>深入细节</h3><h4 id=数据持久化>数据持久化</h4><p>在docker-compose.yml中，我们定义了一个卷<code>postgres_data</code>，用于持久化数据库数据。即使容器被删除，数据仍然保留。</p><h4 id=开发模式>开发模式</h4><p>上面的配置中，我们将主机上的项目目录挂载到容器的/app目录，这样在主机上修改代码时，容器内的代码也会实时更新，便于开发。</p><h4 id=生产环境>生产环境</h4><p>对于生产环境，我们需要调整一些配置，比如：</p><ul><li>使用生产级的Web服务器（如Gunicorn）代替Django开发服务器。</li><li>设置静态文件服务。</li><li>使用环境变量文件（.env）来管理敏感信息。</li></ul><p>通过这个项目，实践了：</p><ul><li>使用Dockerfile构建镜像</li><li>使用Docker Compose编排多服务容器</li><li>配置Django与PostgreSQL数据库连接</li><li>使用数据卷持久化数据</li></ul><p>这只是一个起点，实际项目中还会有更多细节需要处理，但基本流程如此，可以帮助对Docker的理解。</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>后边的项目细节来自和deepseek的对话
</span></span></code></pre></div><h2 id=国内可用-docker镜像源registry-mirrors>国内可用 Docker镜像源（registry-mirrors）</h2><p>&ldquo;registry-mirrors&rdquo;: [
&ldquo;https://tkcnyb3h.mirror.aliyuncs.com&rdquo;,
&ldquo;https://registry.docker-cn.com&rdquo;,
&ldquo;https://docker.mirrors.ustc.edu.cn&rdquo;,
&ldquo;https://hub-mirror.c.163.com&rdquo;,
&ldquo;https://mirror.baidubce.com&rdquo;,
&ldquo;https://ccr.ccs.tencentyun.com&rdquo;，
&ldquo;https://docker.m.daocloud.io&rdquo;,
&ldquo;https://docker.udayun.com&rdquo;,
&ldquo;https://noohub.ru&rdquo;,
&ldquo;https://huecker.io&rdquo;,
&ldquo;https://dockerhub.timeweb.cloud&rdquo;
]</p><p>如果使用 docker pull命令时无法正常拉取docker image，可以试着更换国内可用的docker镜像源。</p></div></article></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e);const t=document.createElement("button");t.className="copy-code",t.textContent="Copy",t.addEventListener("click",()=>{navigator.clipboard.writeText(e.textContent).then(()=>{t.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{t.textContent="Copy",t.classList.remove("copied")},2e3)})}),e.parentElement.prepend(t)});const o=document.querySelectorAll(".article-content h2[id], .article-content h3[id]"),i=document.querySelectorAll('.toc a[href^="#"]'),a=document.querySelector(".top-nav").offsetHeight,n=document.querySelector(".toc-container"),e=[];o.forEach(t=>{e.push({id:t.id,top:t.offsetTop-a-20})});function s(){const s=window.scrollY;let t="";for(let n=e.length-1;n>=0;n--)if(e[n].top<=s+50){t=e[n].id;break}i.forEach(e=>{const s=e.getAttribute("href")===`#${t}`;if(e.classList.toggle("active",s),s){const t=e.offsetTop-n.clientHeight/2;n.scrollTop=t}})}let t=!1;window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(()=>{s(),t=!1}),t=!0)}),s()})</script></body></html>