<!doctype html><html lang=en><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>在github基于个人或公司GitHub Pages部署hugo博客之一 | 技术博客</title><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css><link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;500&display=swap" rel=stylesheet><style>:root{--nav-height:60px;--toc-width:280px;--content-padding:40px;--primary-color:#3498db;--text-color:#333;--light-gray:#f5f5f5;--border-color:#eaeaea}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,segoe ui,Roboto,sans-serif;color:var(--text-color);line-height:1.6;padding-top:var(--nav-height);overflow-x:hidden}.top-nav{position:fixed;top:0;left:0;right:0;height:var(--nav-height);background:#fff;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;align-items:center;padding:0 30px;z-index:1000}.nav-container{width:100%;max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center}.site-title{font-size:1.4rem;font-weight:700;color:var(--primary-color);text-decoration:none}.nav-links{display:flex;gap:25px}.nav-links a{color:var(--text-color);text-decoration:none;font-size:1rem;transition:color .3s}.nav-links a:hover{color:var(--primary-color)}.main-container{display:flex;max-width:1400px;margin:0 auto;padding:20px}.toc-container{position:sticky;top:calc(var(--nav-height) + 20px);align-self:flex-start;width:var(--toc-width);padding:20px;margin-right:30px;max-height:calc(100vh - var(--nav-height) - 40px);overflow-y:auto;background:var(--light-gray);border-radius:8px;scroll-behavior:auto;overscroll-behavior:contain}.toc-title{font-size:1.2rem;margin-bottom:15px;padding-bottom:10px;border-bottom:2px solid var(--primary-color)}.toc ul{list-style:none;padding-left:15px}.toc li{margin-bottom:8px;position:relative}.toc a{color:var(--text-color);text-decoration:none;display:block;padding:5px 0 5px 10px;transition:all .2s;font-size:.95rem;border-left:2px solid transparent}.toc a:hover{color:var(--primary-color);transform:translateX(5px)}.toc a.active{color:var(--primary-color);font-weight:700;border-left:3px solid var(--primary-color);background:rgba(52,152,219,5%);transform:translateX(5px)}.content-container{flex:1;background:#fff;padding:var(--content-padding);border-radius:8px;box-shadow:0 2px 15px rgba(0,0,0,5%)}.article-header{margin-bottom:30px;border-bottom:1px solid var(--border-color);padding-bottom:20px}.article-title{font-size:2rem;margin-bottom:10px;color:#2c3e50}.article-meta{display:flex;gap:20px;color:#7f8c8d;font-size:.9rem;margin-bottom:15px}.article-content{line-height:1.8}.article-content h2{font-size:1.6rem;margin:2rem 0 1rem;padding-bottom:.5rem;border-bottom:1px solid var(--border-color);scroll-margin-top:calc(var(--nav-height) + 20px)}.article-content h3{font-size:1.3rem;margin:1.5rem 0 .8rem;scroll-margin-top:calc(var(--nav-height) + 20px)}.article-content img{max-width:100%;height:auto;border-radius:6px;margin:1.5rem 0;box-shadow:0 3px 10px rgba(0,0,0,.1)}.article-content pre{position:relative;background:#f7f7f7;color:#242424;border-left:4px solid #04b04f;border-radius:8px;padding:1.5rem 1rem 1rem;margin:1.5rem 0;overflow:auto;box-shadow:0 1px 3px rgba(0,0,0,.1);max-height:40vh;white-space:pre-wrap;font-family:fira code,Menlo,Monaco,Consolas,monospace;font-size:.9rem;line-height:1.5;scrollbar-width:thin;scrollbar-color:#c4c4c4 #f7f7f7}.article-content code{font-family:inherit;color:inherit !important;background:0 0 !important;padding:0;text-shadow:none !important;font-size:.9rem}.hljs-meta,.hljs-built_in{color:#04b04f}.hljs-attribute{color:#e91e63}.hljs-string{color:#2e7d32}.hljs-number{color:#2196f3}.article-content pre::-webkit-scrollbar{width:12px;height:12px}.article-content pre::-webkit-scrollbar{width:12px;height:12px}.article-content pre::-webkit-scrollbar-thumb{background:#04b04f;opacity:.6;border:3px solid #f7f7f7}.article-content pre::-webkit-scrollbar-track{background:#f7f7f7;border-radius:6px}.copy-code{position:absolute;top:10px;right:15px;background:rgba(0,0,0,.1);border:1px solid rgba(0,0,0,.2);color:#242424;border-radius:4px;padding:3px 8px;font-size:.8rem;cursor:pointer;transition:all .3s;opacity:0;z-index:10}pre:hover .copy-code{opacity:1}.copy-code:hover{background:rgba(0,0,0,.2)}.copy-code.copied{background:#28a745;color:#fff;border-color:#28a745}@media(max-width:1024px){.toc-container{width:240px;padding:15px}.content-container{padding:25px}}@media(max-width:768px){.main-container{flex-direction:column}.toc-container{position:static;width:100%;margin-right:0;margin-bottom:30px;max-height:none}.article-title{font-size:1.8rem}.article-content pre{max-height:50vh;padding-right:10px}}</style></head><body><nav class=top-nav><div class=nav-container><a href=/ class=site-title>技术博客</a><div class=nav-links><a href=/>首页</a>
<a href=/posts/>所有文章</a>
<a href=/categories/>分类</a>
<a href=/tags/>标签</a></div></div></nav><div class=main-container><aside class=toc-container><h3 class=toc-title>目录</h3><div class=toc><nav id=TableOfContents><ul><li><ul><li><ul><li><a href=#使用github推荐的hugo-actions-workflow自动化部署hugo博客站点>使用github推荐的hugo actions workflow自动化部署hugo博客站点</a></li></ul></li></ul></li></ul></nav></div></aside><article class=content-container><header class=article-header><h1 class=article-title>在github基于个人或公司GitHub Pages部署hugo博客之一</h1><div class=article-meta><span>📅 2022年11月14日</span></div></header><div class=article-content><h4 id=使用github推荐的hugo-actions-workflow自动化部署hugo博客站点>使用github推荐的hugo actions workflow自动化部署hugo博客站点</h4><p>前一篇文章记录了手动模式推送hugo博客站点到github,采用的是基于项目的仓库，采用username/hugo.git的形式建立仓库，在项目根目录下建立docs目录，把静态博客站点发布在main分支的docs目录。</p><p>这篇记录一下基于个人的仓库，采用的是username.github.io形式的仓库。</p><ul><li><p>新建username.github.io的空仓</p></li><li><p>根据hugo官网推荐的QuickStart入门教程，建立Hugo博客项目</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>hugo  new   site  hugo
</span></span><span class=line><span class=cl>cd hugo 
</span></span><span class=line><span class=cl>git  init
</span></span><span class=line><span class=cl>git  submodule add https://github.com/theNewDynamic/gohugo-theme-ananke.git  themes/ananke
</span></span><span class=line><span class=cl>编辑config.toml文件，在最后新增  theme  =  &#34;ananke&#34;
</span></span><span class=line><span class=cl>修改baseURL = &#34;https://username.github.io&#34;
</span></span><span class=line><span class=cl>hugo  new  posts/文档名称作为目录名/index.md    --编辑自己的文档
</span></span><span class=line><span class=cl>git  add .
</span></span><span class=line><span class=cl>git  commit -m   &#34;新增文档&#34;
</span></span><span class=line><span class=cl>git  push  -u origin  main --第一次推送到空仓username.github.io时要带上-u参数，以后不需要带-u参数
</span></span></code></pre></div></li><li><p>新建actions实现自动发布静态站点</p><ul><li>github pages自带actions操作方法：进入该仓库，选择settings-pages,在Build and Deployment 的Source部分选择GitHub Actions，直接进入hugo.yml编辑界面，直接点击右侧的commit就可以在仓库新建hugo.yml文件，路径是.github\workflows\hugo.yml，什么有没有修改，可以实现自动发布。</li><li>很神奇，在username.github.io仓库的actions下采用了github推荐的hugo站点actions workflow，点击commit后在项目的根目录下新建了hugo.yml文件，新增博客文档后，git-add-commit-push 之后，显示deploy successful，使用https://username.github.io，居然可以正确的显示最新发布的文章，也就是说，什么也没有配置，直接可以发布成功，而且没有用到自己手动建立的gh-pages分支。</li></ul><p>我很好奇，怎么实现的呢？那么多参数，不太明白具体的作用，慢慢来^-^
hugo.yml</p></li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-gdscript3 data-lang=gdscript3><span class=line><span class=cl><span class=c1># Sample workflow for building and deploying a Hugo site to GitHub Pages</span>
</span></span><span class=line><span class=cl><span class=n>name</span><span class=p>:</span> <span class=n>Deploy</span> <span class=n>Hugo</span> <span class=n>site</span> <span class=n>to</span> <span class=n>Pages</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>on</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=c1># Runs on pushes targeting the default branch</span>
</span></span><span class=line><span class=cl>  <span class=n>push</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>branches</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;main&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Allows you to run this workflow manually from the Actions tab</span>
</span></span><span class=line><span class=cl>  <span class=n>workflow_dispatch</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages</span>
</span></span><span class=line><span class=cl><span class=n>permissions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>contents</span><span class=p>:</span> <span class=n>read</span>
</span></span><span class=line><span class=cl>  <span class=n>pages</span><span class=p>:</span> <span class=n>write</span>
</span></span><span class=line><span class=cl>  <span class=n>id</span><span class=o>-</span><span class=n>token</span><span class=p>:</span> <span class=n>write</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Allow one concurrent deployment</span>
</span></span><span class=line><span class=cl><span class=n>concurrency</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>group</span><span class=p>:</span> <span class=s2>&#34;pages&#34;</span>
</span></span><span class=line><span class=cl>  <span class=n>cancel</span><span class=o>-</span><span class=ow>in</span><span class=o>-</span><span class=n>progress</span><span class=p>:</span> <span class=bp>true</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Default to bash</span>
</span></span><span class=line><span class=cl><span class=n>defaults</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=n>run</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>shell</span><span class=p>:</span> <span class=n>bash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>jobs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>  <span class=c1># Build job</span>
</span></span><span class=line><span class=cl>  <span class=n>build</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>runs</span><span class=o>-</span><span class=n>on</span><span class=p>:</span> <span class=n>ubuntu</span><span class=o>-</span><span class=n>latest</span>
</span></span><span class=line><span class=cl>    <span class=n>env</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>HUGO_VERSION</span><span class=p>:</span> <span class=mf>0.102</span><span class=o>.</span><span class=mi>3</span>
</span></span><span class=line><span class=cl>    <span class=n>steps</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Install</span> <span class=n>Hugo</span> <span class=n>CLI</span>
</span></span><span class=line><span class=cl>        <span class=n>run</span><span class=p>:</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>          <span class=n>wget</span> <span class=o>-</span><span class=n>O</span> <span class=o>$</span><span class=p>{{</span> <span class=n>runner</span><span class=o>.</span><span class=n>temp</span> <span class=p>}}</span><span class=o>/</span><span class=n>hugo</span><span class=o>.</span><span class=n>deb</span> <span class=n>https</span><span class=p>:</span><span class=o>//</span><span class=n>github</span><span class=o>.</span><span class=n>com</span><span class=o>/</span><span class=n>gohugoio</span><span class=o>/</span><span class=n>hugo</span><span class=o>/</span><span class=n>releases</span><span class=o>/</span><span class=n>download</span><span class=o>/</span><span class=n>v</span><span class=o>$</span><span class=p>{</span><span class=n>HUGO_VERSION</span><span class=p>}</span><span class=o>/</span><span class=n>hugo_extended_</span><span class=o>$</span><span class=p>{</span><span class=n>HUGO_VERSION</span><span class=p>}</span><span class=n>_Linux</span><span class=o>-</span><span class=mi>64</span><span class=n>bit</span><span class=o>.</span><span class=n>deb</span> \
</span></span><span class=line><span class=cl>          <span class=o>&amp;&amp;</span> <span class=n>sudo</span> <span class=n>dpkg</span> <span class=o>-</span><span class=n>i</span> <span class=o>$</span><span class=p>{{</span> <span class=n>runner</span><span class=o>.</span><span class=n>temp</span> <span class=p>}}</span><span class=o>/</span><span class=n>hugo</span><span class=o>.</span><span class=n>deb</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Checkout</span>
</span></span><span class=line><span class=cl>        <span class=n>uses</span><span class=p>:</span> <span class=n>actions</span><span class=o>/</span><span class=n>checkout</span><span class=err>@</span><span class=n>v3</span>
</span></span><span class=line><span class=cl>        <span class=n>with</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>submodules</span><span class=p>:</span> <span class=n>recursive</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Setup</span> <span class=n>Pages</span>
</span></span><span class=line><span class=cl>        <span class=n>id</span><span class=p>:</span> <span class=n>pages</span>
</span></span><span class=line><span class=cl>        <span class=n>uses</span><span class=p>:</span> <span class=n>actions</span><span class=o>/</span><span class=n>configure</span><span class=o>-</span><span class=n>pages</span><span class=err>@</span><span class=n>v2</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Build</span> <span class=n>with</span> <span class=n>Hugo</span>
</span></span><span class=line><span class=cl>        <span class=n>env</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=c1># For maximum backward compatibility with Hugo modules</span>
</span></span><span class=line><span class=cl>          <span class=n>HUGO_ENVIRONMENT</span><span class=p>:</span> <span class=n>production</span>
</span></span><span class=line><span class=cl>          <span class=n>HUGO_ENV</span><span class=p>:</span> <span class=n>production</span>
</span></span><span class=line><span class=cl>        <span class=n>run</span><span class=p>:</span> <span class=o>|</span>
</span></span><span class=line><span class=cl>          <span class=n>hugo</span> \
</span></span><span class=line><span class=cl>            <span class=o>--</span><span class=n>minify</span> \
</span></span><span class=line><span class=cl>            <span class=o>--</span><span class=n>baseURL</span> <span class=s2>&#34;${{ steps.pages.outputs.base_url }}/&#34;</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Upload</span> <span class=n>artifact</span>
</span></span><span class=line><span class=cl>        <span class=n>uses</span><span class=p>:</span> <span class=n>actions</span><span class=o>/</span><span class=n>upload</span><span class=o>-</span><span class=n>pages</span><span class=o>-</span><span class=n>artifact</span><span class=err>@</span><span class=n>v1</span>
</span></span><span class=line><span class=cl>        <span class=n>with</span><span class=p>:</span>
</span></span><span class=line><span class=cl>          <span class=n>path</span><span class=p>:</span> <span class=o>./</span><span class=n>public</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1># Deployment job</span>
</span></span><span class=line><span class=cl>  <span class=n>deploy</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>environment</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=n>name</span><span class=p>:</span> <span class=n>github</span><span class=o>-</span><span class=n>pages</span>
</span></span><span class=line><span class=cl>      <span class=n>url</span><span class=p>:</span> <span class=o>$</span><span class=p>{{</span> <span class=n>steps</span><span class=o>.</span><span class=n>deployment</span><span class=o>.</span><span class=n>outputs</span><span class=o>.</span><span class=n>page_url</span> <span class=p>}}</span>
</span></span><span class=line><span class=cl>    <span class=n>runs</span><span class=o>-</span><span class=n>on</span><span class=p>:</span> <span class=n>ubuntu</span><span class=o>-</span><span class=n>latest</span>
</span></span><span class=line><span class=cl>    <span class=n>needs</span><span class=p>:</span> <span class=n>build</span>
</span></span><span class=line><span class=cl>    <span class=n>steps</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=o>-</span> <span class=n>name</span><span class=p>:</span> <span class=n>Deploy</span> <span class=n>to</span> <span class=n>GitHub</span> <span class=n>Pages</span>
</span></span><span class=line><span class=cl>        <span class=n>id</span><span class=p>:</span> <span class=n>deployment</span>
</span></span><span class=line><span class=cl>        <span class=n>uses</span><span class=p>:</span> <span class=n>actions</span><span class=o>/</span><span class=n>deploy</span><span class=o>-</span><span class=n>pages</span><span class=err>@</span><span class=n>v1</span>
</span></span></code></pre></div><p>点击仓库的actions显示All workflows，选择一个workflows,会在窗口的最下面显示一个artifact,终于看到了熟悉的gh-pages:
<img loading=lazy src=/posts/2022/%E5%9C%A8github%E5%9F%BA%E4%BA%8E%E4%B8%AA%E4%BA%BA%E6%88%96%E5%85%AC%E5%8F%B8github-pages%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E4%B8%80/images/GitHubPagesActions-workflows.png></p><p><img loading=lazy src=/posts/2022/%E5%9C%A8github%E5%9F%BA%E4%BA%8E%E4%B8%AA%E4%BA%BA%E6%88%96%E5%85%AC%E5%8F%B8github-pages%E9%83%A8%E7%BD%B2hugo%E5%8D%9A%E5%AE%A2%E4%B9%8B%E4%B8%80/images/GitHubPagesActions-gh-pages.png></p><p>也就是说这个gh-pages是由系统自己创建的，在这个模式下不需要自己手动建立gh-pages，如果需要指自定义actions，就需要自己建立gh-pages分支发布静态站点文件。</p><p><a href=https://docs.github.com/en/pages/getting-started-with-github-pages/configuring-a-publishing-source-for-your-github-pages-site#publishing-with-a-custom-github-actions-workflow>About publishing sources</a></p><p>About publishing sources</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>You can publish your site when changes are pushed to a specific branch, or you can write a GitHub Actions workflow to publish your site.
</span></span><span class=line><span class=cl>If you do not need any control over the build process for your site, we recommend that you publish your site when changes are pushed to a specific branch. You can specify which branch and folder to use as your publishing source. The source branch can be any branch in your repository, and the source folder can either be the root of the repository (/) on the source branch or a /docs folder on the source branch. Whenever changes are pushed to the source branch, the changes in the source folder will be published to your GitHub Pages site.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>If you want to use a build process other than Jekyll or you do not want a dedicated branch to hold your compiled static files, we recommend that you write a GitHub Actions workflow to publish your site. GitHub provides starter workflows for common publishing scenarios to help you write your workflow.
</span></span></code></pre></div><p>看完Github Docs上关于为github pages 站点配置发布源的解释就明白了，如果你不需要单独的分支来保存编译后的静态文件、或者你不想使用github后台的编译处理过程，推荐你自己编写GitHub Actions workflow来发布你的站点。读到这里，我就把自己手动建立的gh-pages删除了。剩下的就是慢慢研究这个github推荐的hugo.yml文件的实现细节了。当然，也可以使用单独的gh-pags分支，用仓库的secrets.deploy-token来自定义发布过程，实现同样的效果。</p></div></article></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll("pre code").forEach(e=>{hljs.highlightElement(e);const t=document.createElement("button");t.className="copy-code",t.textContent="Copy",t.addEventListener("click",()=>{navigator.clipboard.writeText(e.textContent).then(()=>{t.textContent="Copied!",t.classList.add("copied"),setTimeout(()=>{t.textContent="Copy",t.classList.remove("copied")},2e3)})}),e.parentElement.prepend(t)});const o=document.querySelectorAll(".article-content h2[id], .article-content h3[id]"),i=document.querySelectorAll('.toc a[href^="#"]'),a=document.querySelector(".top-nav").offsetHeight,n=document.querySelector(".toc-container"),e=[];o.forEach(t=>{e.push({id:t.id,top:t.offsetTop-a-20})});function s(){const s=window.scrollY;let t="";for(let n=e.length-1;n>=0;n--)if(e[n].top<=s+50){t=e[n].id;break}i.forEach(e=>{const s=e.getAttribute("href")===`#${t}`;if(e.classList.toggle("active",s),s){const t=e.offsetTop-n.clientHeight/2;n.scrollTop=t}})}let t=!1;window.addEventListener("scroll",()=>{t||(window.requestAnimationFrame(()=>{s(),t=!1}),t=!0)}),s()})</script></body></html>